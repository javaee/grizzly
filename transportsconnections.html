
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2017-06-19
 Rendered using Maven Reflow Skin 1.0.0 (http://andriusvelykis.github.com/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>Project Grizzly - Transports and Connections</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />

		<link href="//netdna.bootstrapcdn.com/bootswatch/2.2.2/cosmo/bootstrap.min.css" rel="stylesheet" />
		<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="./css/bootswatch.css" rel="stylesheet" />
		<link href="./css/reflow-skin.css" rel="stylesheet" />
		
		<link href="//yandex.st/highlightjs/7.3/styles/solarized_dark.min.css" rel="stylesheet" />
		
		<link href="./css/lightbox.css" rel="stylesheet" />
		
		<link href="./css/site.css" rel="stylesheet" />
		<link href="./css/print.css" rel="stylesheet" media="print" />
		
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->

	</head>

	<body class="page-transportsconnections project-site" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="index.html">Project <span class="color-brown">Grizzly</span></a>
					<div class="nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Download <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="dependencies.html" title="Download">Download </a></li>
								</ul>
							</li>
							<li class="dropdown active">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="overview.html" title="Overview">Overview </a></li>
									<li><a href="dependencies.html" title="Dependencies">Dependencies </a></li>
									<li class="dropdown-submenu">
										<a href="hack" title="Core Framework">Core Framework </a>
										<ul class="dropdown-menu">
											<li><a href="memory.html" title="Memory Management">Memory Management </a></li>
											<li><a href="iostrategies.html" title="I/O Strategies">I/O Strategies </a></li>
											<li class="active"><a href="" title="Transports and Connections">Transports and Connections </a></li>
											<li><a href="filterchainfilters.html" title="FilterChain and Filters">FilterChain and Filters </a></li>
											<li><a href="coreconfig.html" title="Core configuration">Core configuration </a></li>
											<li><a href="portunification.html" title="Port Unification">Port Unification </a></li>
											<li><a href="monitoring.html" title="Monitoring">Monitoring </a></li>
											<li><a href="extras.html" title="Extras">Extras </a></li>
											<li><a href="bestpractices.html" title="Best Practices">Best Practices </a></li>
											<li><a href="quickstart.html" title="Quick Start">Quick Start </a></li>
											<li><a href="samples.html" title="Samples">Samples </a></li>
										</ul>
									</li>
									<li class="dropdown-submenu">
										<a href="hack" title="HTTP">HTTP </a>
										<ul class="dropdown-menu">
											<li><a href="httpframework.html" title="Core HTTP Framework">Core HTTP Framework </a></li>
											<li><a href="httpserverframework.html" title="HTTP Server Framework">HTTP Server Framework </a></li>
											<li><a href="http2.html" title="HTTP/2">HTTP/2 </a></li>
											<li><a href="httpserverframeworkextras.html" title="HTTP Server Framework Extras">HTTP Server Framework Extras </a></li>
											<li><a href="comet.html" title="Comet">Comet </a></li>
											<li><a href="jaxws.html" title="JAXWS">JAXWS </a></li>
											<li><a href="websockets.html" title="WebSockets">WebSockets </a></li>
											<li><a href="ajp.html" title="AJP">AJP </a></li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
	<div class="container">
	
	<!-- Masthead
	================================================== -->
	<header class="jumbotron subhead">
		<div class="row" id="banner">
			<div class="span12">
				<div class="pull-left">
					<a href="index.html" id="bannerLeft"><h1><img src="images/grizzlyHead.png"/>&nbsp;<span class="color-black">Project</span> Grizzly</h1></a>
					<p class="lead">NIO Event Development Simplified</p>
				</div>
				<div class="pull-right">
				</div>
			</div>
		</div>
		<div>
			<ul class="breadcrumb">
				<li class="publishDate version-date">Last Published: 2017-06-19</li>
			</ul>
		</div>
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<ul id="toc" class="nav">
						<li class="toplevel"><a href="#Transports_and_Connections" title="Transports and Connections">Transports and Connections</a></li>
					</ul>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="section"> 
 <div class="page-header">
  <h2 id="Transports_and_Connections">Transports and Connections</h2>
 </div> 
 <p>Transport and Connection represent the core network API in Grizzly 2.3.</p> 
 <p>Transport defines a network transport such as TCP or UDP, including associated resources (thread-pool, memory manager etc) and default configuration for nested Connections.</p> 
 <p>Connection in Grizzly 2.3 represents a single network connection (very similar to socket), depending on type of Transport it could be TCP or UDP connection or any custom connection type.</p> 
 <p>The relationship between Transport and Connection is 1-to-many.</p> 
 <ul> 
  <li> <p>Transports</p> <p><img src="images/coreframework/transport-diagram.png" alt="&quot;&quot;" /></p> <p>Per class diagram above, Grizzly 2.3 has two Transport implementations: NIO TCP and NIO UDP, which is based on Java NIO, though in the future, support for NIO.2 based transports and SCTP will be added once JDK 7 is available.</p> <p>Let’s briefly go throw the auxiliary components mentioned on the diagram</p> 
   <ul> 
    <li>MemoryManager implements the memory allocation/release logic (see the <a href="memory.html">Memory management</a> section);</li> 
   </ul> 
   <ul> 
    <li>ExecutorService represents the Transport associated thread-pool</li> 
   </ul> 
   <ul> 
    <li>Processor transport default Processor logic, which is responsible for processing NIO events. Processors are assigned per Connection, so this one will be taken as the default one, but each Connection may have own customized Processor</li> 
   </ul> 
   <ul> 
    <li>Strategy implements IOStrategy (see <a href="iostrategies.html">I/O Strategies</a> section)</li> 
   </ul> 
   <ul> 
    <li>NIOChannelDistributor is responsible for distributing newly created Connections among Transport NIO Selector threads</li> 
   </ul> 
   <ul> 
    <li>SelectorRunner implements single Selector thread logic, which selects ready NIO events and passes them to the Processor, which will process it according to the Strategy logic</li> 
   </ul> 
   <ul> 
    <li>SelectionKeyHandler is a wrapper over SelectionKey operations, also:</li> 
   </ul> 
   <div class="source"> 
    <pre>-   maps Java NIO operations (OP_READ, OP_WRITE etc) mapping
    to Grizzly IOEvent

-   maps Java NIO SelectionKey to Grizzly Connection
</pre> 
   </div> 
   <ul> 
    <li>SelectorHandler implements thread-safe logic for registering/de-registering SelectableChannels on Selectors, changing SelectionKey interests, executing custom tasks in Selector threads (to avoid unexpected locks)</li> 
   </ul></li> 
  <li> <p>Connections</p> <p><img src="images/coreframework/connection-diagram.png" alt="&quot;&quot;" /></p> <p>On the diagram above we see how Connections are related to Transports and basic Connection abstractions. In Grizzly 2.3 we have TCP and UDP Connection realization, besides that we have special server-Connections for both TCP and UDP.</p> 
   <ul> 
    <li>TCPNIOServerConnection works in a similar way as TCP ServerSocket. It is bound to a specific TCP host:port and listens for the incoming client side TCP connections. When a new TCP connection is ready to be accepted, TCPNIOServerConnection accepts it and, taking into account Transport settings, it configures new connection accordingly.</li> 
   </ul> 
   <ul> 
    <li>UDPNIOServerConnection represents a UDP connection, which is not bound to any specific peer address, so it’s able to receive all the UDP packets targeted to its UDP host:port. In other words the only difference between UDPNIOConnection and UDPNIOServerConnection is that the later is not bound to any peer address.</li> 
   </ul> <p>Let’s briefly describe the rest of the components on the diagram above:</p> 
   <ul> 
    <li>Processor. The logic, which is responsible for processing Connection NIO events (ACCEPT, CONNECT, READ, WRITE, CLOSE)</li> 
   </ul> 
   <ul> 
    <li>SelectionKey. The Connection underlying java.nio.channels.SelectionKey, which defines the NIO SelectableChannel &lt;-&gt; Selector registration.</li> 
   </ul></li> 
  <li> <p>Establishing client connections</p> <p>The ConnectorHandler API is responsible for establishing and initializing client connections.</p> <p><img src="images/coreframework/connectorhandler-diagram.png" alt="&quot;&quot;" /></p> <p>As we see from the diagram above, TCPNIOTransport and UDPNIOTransport implement the SocketConnectorHandler interface, so it’s possible to create a new client Connection using the Transport instance directly like:</p> 
   <div class="source"> 
    <pre>Future&lt;Connection&gt; clientConnectionFuture = tcpNioTransport.connect(&quot;grizzly.java.net&quot;, 80);
Connection clientConnection = clientConnectionFuture.get();
</pre> 
   </div> <p>In this case, newly created client Connections will derive Transport’s Processor. It’s also possible to create customized ConnectorHandler (similar for UDP and TCP transports) like:</p> 
   <div class="source"> 
    <pre>SocketConnectorHandler customUdpConnectorHandler = UDPNIOConnectorHandler.builder(udpNioTransport)
                         .processor(customFilterChain)
                         .build();
Future&lt;Connection&gt; clientConnectionFuture = customUdpConnectorHandler.connect(&quot;timeserver.com&quot;, 3333);
Connection clientConnection = clientConnectionFuture.get();
</pre> 
   </div> <p>We can describe the asynchronous connect operation as two sequence diagrams.</p> <p>The first one shows the steps passed in the current thread, where we call <i>ConnectorHandler.connect(…)</i> operation and get <i>Future&lt;Connection&gt;</i> as the result:</p> <p><img src="images/coreframework/connectorhandler-seq1.png" alt="&quot;&quot;" /></p> <p>So the above code just adds the connection object on the <i>SelectorRunner</i>’s queue, which is being processed from selector-thread. Within the selector-thread the connection will be actually registered on the <i>SelectorRunner</i>’s associated Selector and, once it happens, the <i>SelectorRunner</i> notifies <i>ConnectorHandler</i> about the registration completion and</p> 
   <ul> 
    <li>for UDP transport - <i>UDPNIOConnection</i> gets initialized. The <i>Processor</i> gets notified about CONNECT operation completion and finally the <i>Future&lt;Connection&gt;</i> result becomes available in the custom-thread;</li> 
   </ul> 
   <ul> 
    <li>for TCP transport - we still wait until underlying OS network framework notifies the framework that the connection was actually connected to the destination address (UDP doesn’t have this) and only then <i>Processor</i> gets notified about CONNECT operation completion and finally the <i>Future&lt;Connection&gt;</i> result becomes available in the custom-thread;</li> 
   </ul> <p>In general the logic looks like:</p> <p><img src="images/coreframework/connectorhandler-seq2.png" alt="&quot;&quot;" /></p> <p>When talking about TCP transport, when we’re on the server side and <i>TCPNIOServerConnection</i> accepts new client connection. In this case the processing logic looks pretty much like the diagram above, but instead of “CONNECT” we notify <i>Processor</i> about “ACCEPT” event having occurred on the <i>TCPNIOConnection</i>.</p></li> 
 </ul> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->
	
	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Main</li>
						<li>
							<a href="index.html" title="Home">Home </a>
						</li>
						<li>
							<a href="license.html" title="License">License </a>
						</li>
						<li>
							<a href="using.html" title="Who's Using Grizzly">Who's Using Grizzly </a>
						</li>
						<li class="nav-header">Download</li>
						<li>
							<a href="dependencies.html" title="Download">Download </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Contribute</li>
						<li>
							<a href="contribute.html" title="Contribute">Contribute </a>
						</li>
						<li>
							<a href="http://stackoverflow.com/questions/tagged/grizzly" title="StackOverflow" class="externalLink">StackOverflow </a>
						</li>
						<li>
							<a href="https://twitter.com/project_grizzly" title="Twitter" class="externalLink">Twitter </a>
						</li>
						<li>
							<a href="mailing.html" title="Mailing Lists">Mailing Lists </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Project Info</li>
						<li>
							<a href="./" title="Source Control">Source Control </a>
						</li>
						<li>
							<a href="issues" title="Issue Tracking">Issue Tracking </a>
						</li>
						<li>
							<a href="mailing.html" title="Mailing Lists">Mailing Lists </a>
						</li>
						<li>
							<a href="team-list.html" title="Project Team">Project Team </a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>
		
	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2017. All Rights Reserved.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->

	<!-- Fallback jQuery loading from Google CDN:
	     http://stackoverflow.com/questions/1014203/best-way-to-use-googles-hosted-jquery-but-fall-back-to-my-hosted-library-on-go -->
	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript">
		if (typeof jQuery == 'undefined')
		{
			document.write(unescape("%3Cscript src='./js/jquery-1.8.3.min.js' type='text/javascript'%3E%3C/script%3E"));
		}
	</script>
	
	<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
	<script src="./js/lightbox.js"></script>
	<script src="./js/jquery.smooth-scroll.min.js"></script>
	<!-- back button support for smooth scroll -->
	<script src="./js/jquery.ba-bbq.min.js"></script>
	<script src="//yandex.st/highlightjs/7.3/highlight.min.js"></script>

	<script src="./js/reflow-skin.js"></script>
	
	</body>
</html>
